<!DOCTYPE html>

<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->
  <title>jumbl</title>

  <link type="text/css" rel="stylesheet" href="css/reset.css">
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" href="css/custom-theme/jquery-ui-1.8.21.custom.css" rel="stylesheet" />
    
  <!-- Google web fonts -->
  <link href='http://fonts.googleapis.com/css?family=Fredoka+One' rel='stylesheet' type='text/css'>
    
  <!--[if lt IE 9]> <script src="js/html5shiv.js"></script> <![endif]-->

  <!-- Leaflet css -->
  <link rel="stylesheet" href="leaflet-0.3.1/leaflet.css">
  <!--[if lte IE 8]>  <link rel="stylesheet" href="http://code.leafletjs.com/leaflet-0.3.1/leaflet.ie.css" /><![endif]-->

  <script src="leaflet-0.3.1/leaflet.js"></script>
  
  <script src="js/jquery-1.7.2.js"></script>
  <script src="js/jquery-ui-1.8.21.custom.min.js"></script>
  <script src="js/mapthing.js"></script>
  <script src="js/ga_tracking.js"></script>

  <script>    

	// Set scroll to zero
	window.addEventListener("load",function() {
	    setTimeout(function(){
	        window.scrollTo(0, 1);
	    }, 0);
	});

    currentPath = null;
    userid = null;
    
    function submitPathForm(){
      var createpathdesc = prompt("Enter the title of your new path","My awesome adventure");
      if (createpathdesc !== null) {
        MapThing.createPath(createpathdesc, userid);
      } 
    }

  $(document).ready(function() {
      var gid = MapThing.getQueryVariable("gid",-1);
      if(gid==-1){
        $("#body-content").replaceWith(
        	"<div id=\"body-content\">" +
        		"<div class=\"center-box ui-widget ui-widget-content ui-corner-all\">" +
        			"<h1>Welcome to jumbl!</h1>" +
              		<!-- "<div class=\"login-link-holder\"><a href='#' id=\"google-login\"> Login w/ Google </a></div>" + -->    			
    				"<p>Click below to request an invite to our closed beta.<p>" +
    				"<div class=\"horizontal-align\"><button id=\"jQuery-request-invite-button\">Request An Invite</button></div>" +
    				"<p>Login if you're already registered.</p>" +
    				"<div class=\"horizontal-align\"><button id=\"jQuery-login-button\">Login with Google</button></div>" +
        		"</div>" +
        	"</div>"
        );
        
        var link = "https://accounts.google.com/o/oauth2/auth?" +
          "scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile&" +
          "state=%2Fprofile&" + 
          "redirect_uri=http%3A%2F%2F" + window.location.hostname + "%2Foauth2callback.html&" + 
          "response_type=token&" +
          "client_id=57106561862-02bemf71os91h573kq2tqioeb9gf7adk.apps.googleusercontent.com";
          $('a#google-login').attr('href', link);
        
        
		$('button#jQuery-login-button').click(function() { window.location = link; });
		$('button#jQuery-request-invite-button').click(function() { window.location = link; });
        $('button').button();

      } else {
      
        $.getJSON('django/api/fetchbygid/' + gid, function(data) {
          if ( jQuery.isEmptyObject(data) ) {
            alert("Looks like your not in the database yet");
          } else {
            userid = data[0].id;
            var url = 'django/api/users/'+userid;
            $.getJSON(url, function(user){
              MapThing.loadUserPathList(user.paths);
              MapThing.getAndDrawPath($('select#pathSelectList').val(), true, true);
            });
          }
        });
        $('select#pathSelectList').parent('div').css('padding','0');
        $('select#pathSelectList').change(function() {
          if ($('select#pathSelectList').val() !== null) {
            MapThing.getAndDrawPath($('select#pathSelectList').val(), true, true);
          }
        });
        MapThing.initMap('map');
    }
    
  });
  </script>
</head>
<body>

<header id="body-header">
  <div class="inner">
    <h1>jumbl</h1>
  </div>
</header>  

<div id="body-content">
  <div id="crosshairs"><img src='img/crosshairs.gif' /></div>
  <div id="map"> </div>
  <div>
  	  <div>
	      <div id="locate-button" class="button">
	      		<a href="javascript:void(0)" onclick="MapThing.locate()" title="Locate your position on the map" >Locate</a>
	      </div>
	      <div id="drop-point-button" class="button">
	      		<a href="javascript:void(0)" onclick="MapThing.dropPointCenter()" title="Drop a new point on the map" >Drop Point</a>
	      </div>
	      <div id="create-path-button" class="button">
	      		<a href="javascript:void(0)" onclick="submitPathForm()" title="Create a new path" >New Path</a>
	      </div>
	      <div id="share-button" class="button">
	      		<a href="javascript:void(0)" onclick="MapThing.shareFromSelect()" title="Share the current map" >View Path</a>
	      </div>
	      <div id="path-list-button" class="button">
	      	<select id="pathSelectList"></select>
	      </div>
      </div>
  </div>
  <!--
  <div class="info-box">
    <ul id="userlist"></ul>
  </div>
  -->
</div>

<footer id="body-footer"></footer>

</body>
</html>
