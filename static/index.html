<html>
    
    <head>
        <title>map thang</title>
        <link rel="stylesheet" href="leaflet-0.3.1/leaflet.css">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="http://code.leafletjs.com/leaflet-0.3.1/leaflet.ie.css"
            />
        <![endif]-->
	<script src="leaflet-0.3.1/leaflet.js"></script>
	<script src="js/jquery-1.7.2.js"></script>
    </head>
    
    <body>
        <div id="map" style="height: 500px; width: 75%"></div>
        <script>
            drawMap = function () {
                // initialize the map on the "map" div
                var map = new L.Map('map');
                var cloudmade = new L.TileLayer('http://{s}.tile.cloudmade.com/7ed9bab0587c49f79a34e6c987ed60fb/997/256/{z}/{x}/{y}.png', {
                    attribution: '',
                });

                var url = '../api/path/1.json';
                $.getJSON(url, function (json) {
                    var latlngs = [];
                    $.each(json.points, function (key, val) {
                        var point = new L.LatLng(val.lat, val.lon);
                        latlngs.push(point);

                        var marker = new L.Marker(point);
                        map.addLayer(marker);
                        marker.bindPopup('Point: ' + val.id + ' at Time: ' + val.time);
                    });
                    var polyline = new L.Polyline(latlngs, {
                        color: 'red'
                    });
                    map.addLayer(polyline);
                    map.fitBounds(new L.LatLngBounds(latlngs));
                    map.addLayer(cloudmade);
                });
            }

            // apparently this is how you are supposed to do onload
            window.addEventListener ? window.addEventListener("load", drawMap, false) : window.attachEvent && window.attachEvent("onload", drawMap);
        </script>
    </body>
</html>
