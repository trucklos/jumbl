<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
        <!-- not ready for this, but this will make it a real web app: meta name="apple-mobile-web-app-capable" content="yes" / -->
        <title>jumbl</title>
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
        <link rel="stylesheet" href="css/m.css" />

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
        <script src="js/mapthing.js"></script>

    </head>
    <body>
        <div data-role="page" id="venue-search">
          <div data-role="header">
            <form name="foursquare-search" action="javascript:void(0)" onSubmit="foursquareSearch()">
              <input type="search" name="search" id="search-basic" value="" data-mini="true" />
            </form>
          </div>
          <div data-role="content">
            <ul id="venue-list" data-role="listview" data-theme="d" data-divider-theme="d" >
              <li data-role="list-divider">nearby</li>
            </ul>
          </div>
        </div>
        <script>

function searchFoursquare(lat, lon, query, callback){
  var query = typeof(query) === 'undefined' ? "" : query;
  var searchString="https://api.foursquare.com/v2/venues/search?client_id=QTVZ0RMVUR3GEO30XJTKAWT02XMEQINHOH2FAEUFM42CZWMU&client_secret=4UAF15NQOUJKN1MJYOLY4U0PNWW1MLYLLSM0VYWYTRI4XF2X&ll={lat},{lon}&query={query}"
  searchString = searchString.replace("{lat}",String(lat)).replace("{lon}",String(lon)).replace("{query}",query);
  $.ajax({"url":searchString}).done(function (data){
    callback(data.response.groups[0].items);
  });
}

function populateFoursquare(query){
  
  searchFoursquare(42.3875,-71.1, query,function(d){
    var newContent = [];
    $.each(d, function(key, val){
      newContent.push("<li> <a href=\"javascript:void(0)\" onclick=\"\">"+val.name+"<br/>"+
      "<div style='color:#BBB;size=-1'>"+
        (typeof(val.location.address)==='undefined'?"":val.location.address+", ")+
        (typeof(val.location.city)==='undefined'?"":val.location.city)+
        (typeof(val.location.distance)==='undefined'?"": " ("+String(Math.round(val.location.distance/1609.344*10)/10)+" mi)"  )+
      "</div> </a> </li>");
      console.log(val);
    });
    $("ul#venue-list").html(newContent.join('\n'));
    $("ul#venue-list").listview("refresh");
  });
}

function foursquareSearch(){
  populateFoursquare( $("input#search-basic").val() );
  return false;
}

$(document).ready(function(){
  populateFoursquare();
});

        </script>
    </body>
</html>


